name: Call API For Respective Selection

on:
  workflow_dispatch:
    inputs:
      endpoint:
        description: 'Select the Knowron action to perform'
        required: true
        type: choice
        options:
          - Knowron Find Bugs
          - Knowron Create Documentation

jobs:
  call-api:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ§  Map Selection to API Endpoint
        id: map
        run: |
          echo "ğŸ“¥ Selected Knowron Action: '${{ github.event.inputs.endpoint }}'"
          
          if [[ "${{ github.event.inputs.endpoint }}" == "Knowron Find Bugs" ]]; then
            echo "endpoint=users" >> $GITHUB_OUTPUT
            echo "ğŸ”§ Mapping to endpoint: /users"
          elif [[ "${{ github.event.inputs.endpoint }}" == "Knowron Create Documentation" ]]; then
            echo "endpoint=posts" >> $GITHUB_OUTPUT
            echo "ğŸ“ Mapping to endpoint: /posts"
          else
            echo "âŒ Unknown selection!"
            exit 1
          fi  # <-- THIS WAS MISSING!

      - name: ğŸ“¦ Install jq for JSON formatting
        run: |
          sudo apt-get update && sudo apt-get install -y jq

      - name: ğŸ”— Call API and Display Response
        run: |
          URL="https://dummyjson.com/${{ steps.map.outputs.endpoint }}"
          echo "ğŸŒ Calling API at: $URL"

          RESPONSE=$(curl --fail -s -X GET "$URL")
          if [ $? -ne 0 ]; then
            echo "âŒ Failed to call API"
            exit 1
          fi
          
          echo "âœ… API call successful!"
          echo "ğŸ“¦ Raw Response:"
          echo "$RESPONSE"

          echo ""
          echo "ğŸ§¾ Pretty-Printed Response (first 20 lines):"
          echo "$RESPONSE" | jq '.' | head -n 20
