name: Call API For Respective Selection

on:
  workflow_dispatch:
    inputs:
      endpoint:
        description: 'Select the Knowron action to perform'
        required: true
        type: choice
        options:
          - Knowron Find Bugs
          - Knowron Create Documentation

jobs:
  call-api:
    runs-on: ubuntu-latest
    steps:
      - name: 🧠 Map Selection to API Endpoint
        id: map
        run: |
          echo "📥 Selected Knowron Action: '${{ github.event.inputs.endpoint }}'"
          
          if [[ "${{ github.event.inputs.endpoint }}" == "Knowron Find Bugs" ]]; then
            echo "endpoint=users" >> $GITHUB_OUTPUT
            echo "🔧 Mapped to endpoint: /users"
          elif [[ "${{ github.event.inputs.endpoint }}" == "Knowron Create Documentation" ]]; then
            echo "endpoint=posts" >> $GITHUB_OUTPUT
            echo "📝 Mapped to endpoint: /posts"
          else
            echo "❌ Unknown selection!"
            exit 1
          fi

      - name: 📦 Install jq for JSON formatting
        run: |
          sudo apt-get update && sudo apt-get install -y jq

      - name: 🔗 Call API and Show Structured Response
        run: |
          URL="https://dummyjson.com/${{ steps.map.outputs.endpoint }}"
          echo "🌐 Calling API at: $URL"

          RESPONSE=$(curl --fail -s -X GET "$URL")
          if [ $? -ne 0 ]; then
            echo "❌ API call failed"
            exit 1
          fi
          
          echo "✅ API Response (Structured):"
          echo "$RESPONSE" | jq '.'
